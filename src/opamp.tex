\documentclass[main.tex]{subfiles}
\begin{document}

\section{Give the transfer function for the following circuits.}

\noindent In a real interview expect just one of these circuits.
% Numerous circuits are analyzed for the sake of building intuition and the showing first principles approach.

\begin{figure}[h!]
    \begin{center}
        \begin{circuitikz}[american]
            \draw (0,0) node[left]{$V_{in}$} to[short] ++ (1,0)
                node[op amp, noinv input up, anchor=+](opamp){}
                (opamp.-) -- ++(0,-1) coordinate(FB)
                (FB) to[short] (FB -| opamp.out) -- (opamp.out)
                to [short] ++(1,0) node[right]{$V_{out}$};
            \label{fig:unity_amp}
        \end{circuitikz}
        \caption{Circuit A}
    \end{center}
\end{figure}

\begin{figure}[h!]
    \begin{center}
        \begin{circuitikz}[american]
            % DRAW: Inverting
            \label{fig:inverting_amp}
        \end{circuitikz}
        \caption{Circuit B}
    \end{center}
\end{figure}

\begin{figure}[h!]
    \begin{center}
        \begin{circuitikz}[american, transform shape]
            \draw (0,0) node[left]{$V_{in}$} to[short] ++ (1,0)
                node[op amp, noinv input up, anchor=+](opamp){}
                (opamp.-) -- ++(0,-1) coordinate(FB)
                to[R=$R_i$] ++(0,-2) node[ground]{}
                (FB) to[R=$R_f$] (FB -| opamp.out) -- (opamp.out)
                to [short] ++(1,0) node[right]{$V_{out}$};
            % Drawing very similar to "CircuiTikZ 1.7.0 Manual Page 23"
            \label{fig:non_inverting_amp}
        \end{circuitikz}
        \caption{Circuit C}
    \end{center}
\end{figure}

\begin{figure}[h!]
    \begin{center}
        \begin{circuitikz}[american]
            % DRAW: Difference amp
            \label{fig:difference_amp}
        \end{circuitikz}
        \caption{Circuit D}
    \end{center}
\end{figure}

\spoilerline

\subsection{Operational Amplifiers}
Ideal opamps (\textit{Operational Amplifier}) are active devices defined by $V_{out} = A \cdot (V_{+} - V_{-})$ and $I_{V_{+}} = I_{V_{-}} = 0$ where $A \approx \inf$. When an opamp is connected in a negative feedback configuration, the inputs, $V_{+}$ and $V_{-}$, are considered "virtually shorted", $V_{+} = V_{-}$. Negative feedback in an opamp circuit means there is a current path from it's output, $V_{out}$, to it's inverting terminal, $V_{-}$.

% consider drawing an opamp with terminals labelled. maybe unnecessary

\subsection{Solutions}
Applying this knowledge of the virtual short assumption we see all configurations given in the question feature negative feedback so we can use in our analysis that $V_{+} = V_{-}$. 

\subsubsection{Unity Gain Amplifier}
From the drawn circuit we see $V_{in} = V_{+}$ and $V_{out} = V_{-}$. For the opamp we can apply $V_{out} = A \cdot (V_{+} - V_{-}) = A \cdot (V_{in} - V_{out}) = A \cdot V_{in} - A \cdot V_{out}$ which can be rearranged into $V_{out} + A \cdot V_{out} = A \cdot V_{in}$, $V_{out} \cdot (1 + A) = A \cdot V_{in}$. Now to solve for the transfer function gives $\frac{V_{out}}{V_{in}} = \frac{A}{1+A}$. Recall that $A \approx \inf$ so the $1$ in the denominator becomes insignificant leading to $\frac{V_{out}}{V_{in}} = 1$ or $V_{out} = V_{in}$.

This circuit can also be solved easily with the virtual short assumption, $V_{+} = V_{-}$, by substituting in $V_{in} = V_{+}$ and $V_{out} = V_{-}$, the solution is trivially $V_{out} = V_{in}$.

This circuit acts as a current buffer. Because $I_{V_{+}} = 0$ and $V_{in} = V_{+}$ we see that $I_{V_{in}} = 0$ so the circuit doesn't load the input at all. However, the op amp is capable of providing however much current is required to any load! 

\subsubsection{Inverting Amplifier}
% TODO write

% solve with A first then show how it can follow the virtual short assumption.

\subsubsection{Non-inverting Amplifier}
% TODO write

% solve only with virtual short assumption. 

Notice when $R_i = \inf \Omega$ and $R_f = 0 \Omega$ the non-inverting amplifier circuit becomes a unity gain amplifier circuit and the transfer function mathematically aligns with this conclusion.

\subsubsection{Difference Amplifier}
% TODO write

% solve only with virtual short assumption. 


\subsection{Non-idealities}
While most interview questions focus on ideal opamps, real opamps suffer from numerous non-idealities. The most important of which should be understood to aid in circuit design questions and are described below. 

\subsubsection{Saturation}
Saturation occurs when 
For a rail to rail opamp, $V_{out}$ is bounded by the rails, $V_{ee}$ and $V_{cc}$, such that $V_{ee} < V_{out} < V_{cc}$. 
% TODO write

\subsubsection{Input Offset Voltage}
% TODO write

\subsubsection{Input Bias Current}
% TODO write

\subsection{Follow-ups}
\begin{itemize}
    \item Why are non-inverting amplifiers preferred over inverting amplifiers? % Input Impedance
    \item What is an Instrumentation Amplifier? When would you use it? % Non-inverting amplifier's buffering a difference amplifier
\end{itemize}

\end{document}
