\documentclass[main.tex]{subfiles}
\begin{document}

\section{Extra Practice: Solve the transfer function of the following circuits.} \label{extra_practice:more_opamps}

\noindent The following circuits are similar to those in Section \ref{section:opamp} and are given as extra exercises with final answers only for checking.

\begin{figure}[H]
    \begin{center}
        \begin{minipage}{0.45\textwidth}
            \centering
            \begin{circuitikz}[american]
                \draw (0,0) node[left]{$V_{in}$} to[short] ++ (1,0)
                    node[op amp, noinv input up, anchor=+](op-amp){}
                    (op-amp.-) -- ++(0,-1) coordinate(FB)
                    (FB) to[short] (FB -| op-amp.out) -- (op-amp.out)
                    to [short] ++(1,0) node[right]{$V_{out}$};
            \end{circuitikz}
            \caption{Circuit A}
            \label{fig:unity-amp}
        \end{minipage}%
        \hfill%
        \begin{minipage}{0.45\textwidth}
            \centering
            \begin{circuitikz}[american]
                \draw (0, 0) node[left]{$V_{in}$};
                \draw (0, 0) to[resistor, l=$R_i$] (2, 0);
                \draw (2, 0) node[op amp, anchor=-](op-amp){};
                \draw (op-amp.+) node[ground]{};
                \draw (2, 0) -- (2, 1);
                \draw (2, 1) to[resistor, l=$R_f$] (4.5, 1);
                \draw (4.5, 1) -- (4.5, -0.5);
                \draw (op-amp.out) to [short] ++ (0.5, 0) node[right]{$V_{out}$};
            \end{circuitikz}
            \caption{Circuit B}
            \label{fig:inverting_amp}
        \end{minipage}
    \end{center}
\end{figure}
\begin{figure}[H]
    \begin{center}
        \begin{minipage}{0.45\textwidth}
            \centering
            \begin{circuitikz}[american, transform shape]
                \draw (0,0) node[left]{$V_{in}$} to[short] ++ (1,0)
                    node[op amp, noinv input up, anchor=+](op-amp){}
                    (op-amp.-) -- ++(0,-1) coordinate(FB)
                    to[R=$R_i$] ++(0,-2) node[ground]{}
                    (FB) to[R=$R_f$] (FB -| op-amp.out) -- (op-amp.out)
                    to [short] ++(1,0) node[right]{$V_{out}$};
            \end{circuitikz}
            \caption{Circuit C}
            \label{fig:non_inverting_amp}
        \end{minipage}%
        \hfill%
        \begin{minipage}{0.45\textwidth}
            \centering
            \begin{circuitikz}[american]
                \draw (0, 0) node[left]{$V_{in-}$};
                \draw (0, 0) to[resistor, l=$R_1$, i=$I_{1}$] (2, 0);
                \draw (2, 0) node[op amp, anchor=-](op-amp){};
                \draw (2, 0) -- (2, 1);
                \draw (2, 1) to[resistor, l=$R_3$] (4.5, 1);
                \draw (4.5, 1) -- (4.5, -0.5);
                \draw (op-amp.out) to [short] ++ (0.5, 0) node[right]{$V_{out}$};
                \draw (0, -1) node[left]{$V_{in+}$};
                \draw (0, -1) to[resistor, l=$R_2$, i=$I_{2}$] (2, -1);
                \draw (2, -1) to[resistor, l=$R_4$] (2, -3);
                \draw (2, -3) node[ground]{};
            \end{circuitikz}
            \caption{Circuit D}
            \label{fig:difference_amp}
        \end{minipage}
    \end{center}
\end{figure}

\spoilerline

\subsection{Solutions}
\begin{itemize}
    \item Circuit A is a unity gain amplifier where $\frac{V_{out}}{V_{in}} = 1$.
    \item Circuit B is an inverting amplifier where $\frac{V_{out}}{V_{in}} = -\frac{R_f}{R_i}$.
    \item Circuit C is a non-inverting amplifier where $\frac{V_{out}}{V_{in}} = 1 + \frac{R_f}{R_i}$.
    \item Circuit D is a differential amplifier where $V_{out} = -V_{in-} \cdot \frac{R_3}{R_1} + V_{in+} \cdot \frac{R_4}{R_2 + R_4} \cdot \frac{R_1 + R_3}{R_1}$. Consider a special case when $R_1 = R_2$ and $R_3 = R_4$ where the transfer function becomes $\frac{V_{out}}{V_{in+} - V_{in-}} = \frac{R_3}{R_1}$. Additionally, if $R_1 = R_2 = R_3 = R_4$ then $V_{out} = V_{in+} - V_{in-}$.
\end{itemize}

\end{document}
