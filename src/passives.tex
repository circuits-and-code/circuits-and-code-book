\documentclass[main.tex]{subfiles}
\begin{document}

\section{Determine the step response of the following circuits.}

\noindent State any assumptions regarding component values. 
% Deliberately not stating "Assume that there is no load on the output of the circuits" so that our guide questions are reflective of how questions are asked in real world. Stating this as a valid assumption is done in the solution.

\begin{figure}[H]
    \begin{center}
        \begin{minipage}{0.45\textwidth}
            \centering
            \begin{circuitikz}[american]
                \draw (0, 4) node[anchor=east] {$V_{in}$};
                \draw (0, 4) to[resistor, l=$R$] (5, 4);
                \draw (5, 4) node[right] {$V_{out}$};
                \draw (-0.5, 2) -- (5.5, 2);
                \draw (3, 2) node[ground]{};
                \label{fig:series_resistor}
            \end{circuitikz}
            \caption{Circuit A}
        \end{minipage}%
        \hfill%
        \begin{minipage}{0.45\textwidth}
            \centering
            \begin{circuitikz}[american]
                \draw (0, 4) node[anchor=east] {$V_{in}$};
                \draw (0, 4) to[resistor, l=$R_1$] (5, 4);
                \draw (3.5, 4) to[resistor, l=$R_2$] (3.5, 2);
                \draw (5, 4) node[right] {$V_{out}$};
                \draw (-0.5, 2) -- (5.5, 2);
                \draw (3, 2) node[ground]{};
                \label{fig:voltage_divider}
            \end{circuitikz}
            \caption{Circuit B}
        \end{minipage}
    \end{center}
\end{figure}

\begin{figure}[H]
    \begin{center}
        \begin{minipage}{0.45\textwidth}
            \centering
            \begin{circuitikz}[american]
                \draw (0, 4) node[anchor=east] {$V_{in}$};
                \draw (0, 4) to[resistor, l=$R$] (5, 4);
                \draw (3.5, 4) to[capacitor, l=$C$] (3.5, 2);
                \draw (5, 4) node[right] {$V_{out}$};
                \draw (-0.5, 2) -- (5.5, 2);
                \draw (3, 2) node[ground]{};
                \label{fig:rc_low_pass_filter}
            \end{circuitikz}
            \caption{Circuit C}
        \end{minipage}%
        \hfill%
        \begin{minipage}{0.45\textwidth}
            \centering
            \begin{circuitikz}[american]
                \draw (0, 4) node[anchor=east] {$V_{in}$};
                \draw (0, 4) to[capacitor, l=$C$] (5, 4);
                \draw (3.5, 4) to[resistor, l=$R$] (3.5, 2);
                \draw (5, 4) node[right] {$V_{out}$};
                \draw (-0.5, 2) -- (5.5, 2);
                \draw (3, 2) node[ground]{};
                \label{fig:rc_high_pass_filter}
            \end{circuitikz}
            \caption{Circuit D}
        \end{minipage}
    \end{center}
\end{figure}

% Removing the below questions because I'm going to consider them too complex for the guide. 

% \begin{figure}[H]
%     \begin{center}
%         \begin{minipage}{0.45\textwidth}
%             \centering
%             \begin{circuitikz}[american]
%                 \draw (0,0) to[isource, l=$I_{in}$] (0,3) -- (2,3) to[C=$C$] (2,0) -- (0,0);
%                 \draw (2, 3) node[right] {$V_{out}$};
%                 \draw (1, 0) node[ground]{};
%                 \label{fig:c_current_source}
%             \end{circuitikz}
%             \caption{Circuit E}
%         \end{minipage}%
%         \hfill%
%         \begin{minipage}{0.45\textwidth}
%             \centering
%             \begin{circuitikz}[american]
%                 \draw (0,0) to[isource, l=$I_{in}$] (0,3);
%                 \draw (0, 3) to[resistor, l=$R$] (3, 3);
%                 \draw (3, 3) node[right] {$V_{out}$};
%                 \draw (3, 3) to[capacitor, l=$C$] (3, 0);
%                 \draw (3, 0) -- (0, 0);
%                 \draw(1.5, 0) node[ground]{};
%                 \label{fig:rc_current_source}
%             \end{circuitikz}
%             \caption{Circuit F}
%         \end{minipage}
%     \end{center}
% \end{figure}

% \begin{figure}[H]
%     \begin{center}
%         \begin{minipage}{0.45\textwidth}
%             \centering
%             \begin{circuitikz}[american]
%                 \draw (0, 4) node[anchor=east] {$V_{in}$};
%                 \draw (0, 4) to[inductor, l=$L$] (5, 4);
%                 \draw (3.5, 4) to[capacitor, l=$C$] (3.5, 2);
%                 \draw (5, 4) node[right] {$V_{out}$};
%                 \draw (-0.5, 2) -- (5.5, 2);
%                 \draw (3, 2) node[ground]{};
%                 \label{fig:lseries_cshunt}
%             \end{circuitikz}
%             \caption{Circuit G}
%         \end{minipage}%
%         \hfill%
%         \begin{minipage}{0.45\textwidth}
%             \centering
%             \begin{circuitikz}[american]
%                 \draw (0, 4) node[anchor=east] {$V_{in}$};
%                 \draw (0, 4) -- (0.75, 4);
%                 \draw (0.75, 4) to[inductor, l=$L$] (2.5, 4);
%                 \draw (2.5, 4) to [capacitor, l=$C$] (4.25, 4);
%                 \draw (4.25, 4) -- (5, 4);
%                 \draw (5, 4) node[right] {$V_{out}$};
%                 \draw (-0.5, 2) -- (5.5, 2);
%                 \draw (3, 2) node[ground]{};
%                 \label{fig:lseries_cseries}
%             \end{circuitikz}
%             \caption{Circuit H}
%         \end{minipage}
%     \end{center}
% \end{figure}

% If I wanted to add even more circuits: Circuit G but with series resistor after the L

\spoilerline

\subsection{Passives}
\noindent For a question like this, assuming ideal components is expected as further information has not been provided to aid in a more complex analysis. In a real interview, it's likely you would be given just one of these circuits. Table \ref{tab:passive_definitions} provides a summary of the key properties of ideal resistors, capacitors, and inductors.
% Numerous circuits are analyzed for the sake of building intuition and the showing first principles approach.

\begin{table}[H]
    \centering
    \begin{tabular}{|c|c|c|c|}
        \hline
        & Resistor & Capacitor & Inductor \\ \hline
        Time Domain & $V = I \cdot R$ & $I = C \cdot \frac{dv}{dt}$ & $V = L \cdot \frac{di}{dt}$ \\ \hline
        Frequency Domain & $Z = R$ & $Z = \frac{1}{j \cdot \omega \cdot C}$ & $Z = j \cdot \omega \cdot L$ \\ \hline
        As $f \to \infty$ & $Z = R$ & $Z \to 0$ & $Z \to \infty$ \\ \hline
        As $f \to 0$ & $Z = R$ & $Z \to \infty$ & $Z \to 0$ \\ \hline
        Energy Stored & $E = 0$ & $E = \frac{1}{2} \cdot C \cdot V^{2}$ & $E = \frac{1}{2} \cdot L \cdot I^{2}$ \\ \hline
        Real Power Dissipation & $P = I \cdot V$ & $P = 0$ & $P = 0$ \\ \hline
    \end{tabular}
    \caption{Passive Element Definitions}
    \label{tab:passive_definitions}
\end{table}

\noindent Keep in mind when interpreting table \ref{tab:passive_definitions} that:
\begin{itemize}
    \item The relationship between angular frequency and frequency is given by: $\omega = 2 \pi f$.
    \item Impedance, $Z$, is frequency dependent for circuits with inductors and capacitors.
    \item $Z = \frac{V}{I}$ represents the impedance of a circuit. 
    \item The imaginary component of impedance, $Z$, represents reactance $X$ which defines a phase shift between $V$ and $I$.
    \item Resistors have no frequency dependence and do not store any energy though they do dissipate power, $P = I \cdot V = I^{2} \cdot R = \frac{V^2}{R}$.
    \item An open circuit (nets that are completely isolated from each other) is represented as connected by an impedance of value $Z = \inf$.
    \item A short circuit (nets that are at the same voltage potential) is represented as connected by an impedance of value $Z = 0$. 
    \item For a series connection of impedances $Z_1$, $Z_2$, \dots, $Z_n$, the equivalent impedance is given by $Z = Z_1 + Z_2 + \cdots + Z_n$.
    \item For a parallel connection of impedances $Z_1$, $Z_2$, \dots, $Z_n$, the equivalent impedance is calculated as $\frac{1}{Z} = \frac{1}{Z_1} + \frac{1}{Z_2} + \cdots + \frac{1}{Z_n}$.
    \item For two impedances in parallel, $Z_1$ and $Z_2$, the formula $\frac{1}{Z} = \frac{1}{Z_1} + \frac{1}{Z_2}$ can be simplified algebraically to $Z = \frac{Z_1 \cdot Z_2}{Z_1 + Z_2}$. 
\end{itemize}

\subsection{Step Response}
The step response of a circuit is what the output waveform with respect to time looks like given a unit step is applied to the input. Traditionally, this means plotting $V_{out}$ waveform given 

\[ V_{in}(t) = \begin{cases} 0 & t < 0 \\ 1 & t \geq 0 \end{cases} \]

% Frequency domain connection probably isn't needed here? 
% \noindent In the Laplace domain, the unit step function is given by $V_{in}(j \omega) = \frac{1}{j \omega}$. To determine the response of a circuit in the Laplace domain, $V_{out}(j \omega) = V_{in}{j \omega} * H(j \omega)$ where $H(j \omega)$ defines the system transfer function. 
% consider adding a plot in the frequency domain showing the step response and explain implications to above passives

\subsection{Circuit A: Series Resistor}
In this circuit we note Ohm's law, $V = I \cdot R$, however, as there is no load, $I=0$ on the resistor in this circuit we note there is no voltage drop, $V=I \cdot R=0 \cdot R=0$, across the resistor, consequently $V_{in} = V_{out}$ for this circuit.  

% TODO DRAW PLOT : showing an input step being followed perfectly, I think Sahil's step response solver already does this, just need to add the figure in. 

Note for this circuit, and for all subsequent circuits as well, an assumption is made that there is no extra loading on $V_out$ and there is no source impedance on $V_in$. This is reasonable as the question shows no extra loading drawn and the question does not state otherwise.

\subsection{Circuit B: Voltage Divider}
This circuit is a voltage divider depicted slightly differently than in a previous question\footnote{Question: \ref{sec:voltage_divider}}, but the same equations hold: $\frac{V_{out}}{V_{in}} = \frac{R_2}{R_1 + R_2}$. In this case, to produce a step response plot an assumption is required about the values of $R_1$ and $R_2$. For simplicity, it is assumed that $R_1 = R_2$, resulting in the following transfer function: $\frac{V_{out}}{V_{in}} = 1/2$.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{generated_images/voltage_divider.png}
    \caption{Step Response of a Voltage Divider Circuit}
    \label{fig:step-response-voltage-divider}
\end{figure}

\subsection{Circuit C: RC Low Pass Filter}
Circuits with inductors and capacitors are dependent on time and frequency and can be analyzed in either domain. For the circuit in Figure \ref{fig:rc_low_pass_filter} analysis will be performed in the time domain. 
% Philosophy: the subsequent question uses frequency domain. Appendix questions allow readers to explore to their hearts desire either approach. 

% Solving this circuit fully in time domain because it is conceptually simple even though mathematically complex.
From the two elements in the circuit we get in the time domain $I = C \cdot \frac{dV_{out}}{dt}$ and $V_{in} - V_{out} = I \cdot R$. Cancelling out $I$ which is equivalent in both elements we get $V_{in} - V_{out} = R \cdot C \cdot \frac{dV_{out}}{dt}$ which can be algebraically manipulated into $-\frac{dV_{out}}{V_{out}-V_{in}} = -\frac{dt}{R \cdot C}$ then performing the integral on each side revealing $\ln{\frac{V_{out}-V_{in}}{V_out}}=-\frac{t}{R \cdot C}$ which can be algebraically manipulated into $V_{out}=V_{in} \cdot (1-e^{\frac{-t}{R \cdot C}})$. Note when analyzing this circuit, a constant $\tau = R \cdot C$ is defined as the time constant of the RC circuit which represents the time it takes $1-e^{-1}$ or ~63 percent of the step size. As the question allows us to choose component values for the components I will assume $R$ and $C$ are chosen such that $\tau = R \cdot C = 1$ for simplicity.
% TODO : break the math out so it's not interleaved with the text to improve readability.Will cost me a lot of space on the page to execute on this but yea

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{generated_images/low_pass_filter.png}
    \caption{Step Response of a Low Pass Filter Circuit}
    \label{fig:step-response-low-pass-filter}
\end{figure}

% Do not analyze in frequency domain though maybe worth including in the appendix because I did write it?
% This circuit can also be analyzed in the frequency domain. In this case for the capacitor $Z_c = \frac{1}{j \cdot \omega \cdot c}$ and for the resistor $Z_r = R$. For the voltage divider, $\frac{V_{out}}{V_{in}} = \frac{R_2}{R_1 + R_2}$, can be extrapolated into $\frac{V_{out}}{V_{in}} = \frac{Z_2}{Z_1 + Z_2}$ so by substituting in the values for this circuit $H = \frac{V_{out}}{V_{in}} = \frac{Z_c}{Z_r + Z_c} = \frac{\frac{1}{j \cdot \omega \cdot c}}{R + \frac{1}{j \cdot \omega \cdot c}} = \frac{1}{1 + j \cdot \omega \cdot c \cdot R} = \frac{1}{1+\frac{j \cdot \omega}{\omega_{0}}}$ where $\omega_{0} = \frac{1}{R \cdot C}$ is defined is a pole of the system transfer function $H$. Plotting this single pole low pass filter reveals:
% To find the step response using the Laplace domain $V_{out}(j \cdot \omega) = H(j \cdot \omega) \cdot \frac{1}{j \cdot w}$ is applied and then an inverse laplace transformation reveals an identical solution to the time domain solution.

% consider appendix item : add in a current plot for the RC step response as well, this is sometimes asked as well but much rarer even though conceptually fairly easy

\subsubsection{Connection to I2C} 
% Connecting the RC circuit to I2C is really important and should go somewhere in the book imo, maybe not in this section I guess.
This circuit is extremely fundamental and has implications for numerous situations. Consider an I2C digital signal in which all drivers are not asserting the line low. In this case the signal trace has some parasitic capacitance to ground and a pullup resistor is responsible for pulling the line to a logic high state. This can be modelled as an RC circuit and consequently a real I2C signal showing states $0101010101$ in reality appear as follows on an oscilloscope:

% DRAW PLOT : I2C signal with real rise time s

Increasing the value of $R_{pullup}$ results in less power consumption, but slower rise times as $\tau = R \cdot C$. There is often a lower limit to the value of $R_{pullup}$ as drivers must be rated for the current to pull the line low. Selecting the value of $R_{pullup}$ is a careful consideration for design engineers with values commonly ranging from $1 k \Omega$ to $10 k \Omega$.
% This is a really strong paragraph. I really want people to understand these tradeoffs! 

% DRAW PLOT : I2C signal same as above but show a smaller R_pullup and a larger R_pullup as well for comparison

When answering a question like this a conceptual sanity check is also useful! As a capacitor behaves like an open circuit in DC it makes sense that as time approaches infinity, Circuit C begins to look like Circuit A! 

\subsection{Circuit D: RC High Pass Filter}
For this question a complex impedance approach will be used rather than time domain analysis though both will produce the correct solution. For a voltage divider, $\frac{V_{out}}{V_{in}} = \frac{R_b}{R_t + R_b}$, this can be extrapolated to impedance values so $\frac{V_{out}}{V_{in}} = \frac{Z_b}{Z_t + Z_b}$ making it applicable in this question. For this circuit $Z_b = Z_r = R$ and $Z_t = Z_c = \frac{1}{j \cdot \omega \cdot C}$ can be substituted in to get $\frac{V_{out}}{V_{in}} = \frac{R}{\frac{1}{j \cdot \omega \cdot C} + R}$.
% TODO : finish the math proof and explain this 

% DRAW quick bode plot ? 

\begin{figure}[H]
    \centering
    \includegraphics[width=0.8\textwidth]{generated_images/high_pass_filter.png}
    \caption{Step Response of a High Pass Filter Circuit}
    \label{fig:step-response-high-pass-filter}
\end{figure}


% \subsection{Circuit E: Series Capacitor with Current Source}
% % would need to add a solution here if I wanted to include this one

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.8\textwidth]{generated_images/series_cap_with_current_source.png}
%     \caption{Step Response of a Circuit with a Series Capacitor and Current Source}
%     \label{fig:step-response-series-cap-with-current-source}
% \end{figure}

% \subsection{Circuit F: Series RC with Current Source}
% % would need to add a solution here if I wanted to include this one

% \subsection{Circuit G: Series Inductor with Shunt Capacitor}
% When analyzing this circuit, we begin with considering what happens as $t \approx \infty$ and $t \approx 0$, as these are the simplest states. For all of $t \leq 0$ it is reasonable to assume there is no energy stored in the passives, $E_l = 0$ and $E_c = 0$, and consequently $V_{out} = 0$ is a valid initial condition. When $t \approx \infty$ it is known that $Z_l \approx \infty$ and $Z_c \approx \infty$ as time increases there are significantly less high frequency components present. This means as $t \approx \infty$ Circuit G begins to appear as Circuit A. 

% % would need to add a solution here if I wanted to include this one
% % math proof

% % Plot
% % label midpoint of oscillation as V_in
% % label max as 2*Vin and the min as 0 

% % explain resonant frequency formula

% % explain rise waveform is based on L and C values 

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.8\textwidth]{generated_images/series_inductor_with_shunt_cap.png}
%     \caption{Step Response of a Circuit with a Series Inductor with Shunt Capacitor}
%     \label{fig:step-response-series-ind-with-shunt-cap}
% \end{figure}

% \subsection{Circuit H: Series Inductor and Capacitor}
% % would need to add a solution here if I wanted to include this one

\subsection{Follow-ups}
\begin{itemize}
    \item Given an unknown discrete capacitor find the capacitance? How would you determine the capacitance at a given DC bias voltage? % First part is Circuit C. Second part a solution is use Circuit E with an initial condition on Vout as the bias and a very small Iin current.
    \item For circuit C, does changing the value of R (assuming all else remains constant) change the total energy dissipated in the resistor? % Answer is no and requires an interesting integral to prove. Someone asked me this recently and I thought it was fun bc i had to do the proof live in fronta them lool. 
\end{itemize}

\end{document}

% TODO : ensure used noindent for all paragraphs. finish other TODOs first because the figures break it up nicely sometimes. 
